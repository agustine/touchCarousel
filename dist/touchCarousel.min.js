/*! Touchcarousel - v0.1.0 - 2013-11-06
* https://github.com/Administrator/jquery.touchCarousel
* Copyright (c) 2013 叶晓毅; Licensed MIT */
!function(a){"use strict";a(jQuery)}(function(a){"use strict";var b=a("<div>"),c=a("<div>"),d=a('<a class="prev-btn"></a>'),e=a('<a class="next-btn"></a>'),f={items:[],firstIndex:0,overlayBackground:"rgba(0,0,0,0.8)",zIndex:1e5,urlAttrName:"image-url",altAttrName:"image-alt",loadingGif:"images/preloader.gif",cycle:!1,dataKey:"imgData",init:function(){},flipOver:function(){},close:function(){},nomore:function(){}};a.fn.touchCarousel=function(g){var h=a(this),i=a.extend(f,g),j=null,k=!1,l=null,m={overlay:"tc-overlay",slider:"tc-slider",imgBox:"tc-img-box"},n={background:i.overlayBackground,"z-index":i.zIndex},o={background:'url("'+i.loadingGif+'") no-repeat center center #DDDDDD'},p=new LinkedList,q=function(b){return null!==b&&void 0!==b?Array.isArray(b)?(a.each(b,function(a,b){p.add(b)}),void 0):(p.add(b),void 0):void 0},r=function(b){if(null!==b&&void 0!==b){if(!Array.isArray(b))return p.add(b),void 0;var c=a.map(b,function(a){return a});a.each(c.reverse(),function(a,b){p.insertBefore(p.getHead().getValue(),b)})}},s=function(b){var c=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;a(b).css({"max-width":c,"max-height":d})},t=function(a){var b=a?"30px":"-30px";c.animate({"margin-left":b},150,"linear",function(){c.animate({"margin-left":0},150,"linear")})},u=function(b){var c=a("<div>").addClass(m.imgBox);if(null===b)return c.attr("image-url","");c.attr("image-url",b.imageUrl);var d=a("<div>").addClass("tc-img-overlay").css(o);c.append(d);var e=a("<img>").data(i.dataKey,b).attr("alt",b.imageAlt).attr("src",b.imageUrl);return d.append(e),s(e),c},v=function(b){j=b||p.getHead();var d="-100%",e=j.getPrevious(),f=j.getNext();i.cycle&&(e=e||p.getTail(),f=f||p.getHead());var g=[e,j,f];c.empty().css("left",d),a.each(g,function(a,b){u(null==b?null:b.getValue()).appendTo(c)})},w=function(a){return k?!1:(b.show(),setTimeout(function(){b.css("opacity",1)},100),v(a),k=!0,void 0)},x=function(){return k?(b.hide(),k=!1,a(".placeholder").empty(),c.empty(),b.remove(),i.close(l),k=!1,l=null,void 0):!1},y=function(){var f=l;i.items&&i.items.length>0?a.each(i.items,function(a,b){p.add(b)}):a(h).each(function(){p.add({imageUrl:a(this).attr(i.urlAttrName),imageAlt:a(this).attr(i.altAttrName)})}),b.css(n),c.addClass(m.slider),b.addClass(m.overlay).append(c),a("body").append(b),w(p.get(i.firstIndex)),i.init(f),"ontouchstart"in window||(b.append(d).append(e),d.click(function(a){a.preventDefault(),f.prev()}),e.click(function(a){a.preventDefault(),f.next()})),a(window).resize(function(){s(a(".tc-img-box img"))})},z=function(){return j.getPos()},A=function(){return p.getSize()},B=function(b){b=void 0===b?!0:b,j=j.getNext();var d=null,e=null;i.cycle&&(j=j||p.getHead(),d=d||p.getHead()),null!=j?(d=j.getNext(),a(c.find(".tc-img-box").get(0)).remove(),e=null==d?null:d.getValue(),c.append(u(e)),i.flipOver(l,!0)):(b&&t(!1),i.nomore(l,!0),j=p.getTail())},C=function(b){b=void 0===b?!0:b,j=j.getPrevious();var d=null,e=null;i.cycle&&(j=j||p.getTail(),d=d||p.getTail()),null!=j?(d=j.getPrevious(),a(c.find(".tc-img-box").get(2)).remove(),e=null==d?null:d.getValue(),c.prepend(u(e)),i.flipOver(l,!1)):(b&&t(!0),i.nomore(l,!1),j=p.getHead())},D=function(){p=new LinkedList,j=null};return a("body").on("touchstart",".tc-slider",function(a){var b=a.originalEvent,d=b.changedTouches[0].pageX;return c.on("touchmove",function(a){a.preventDefault(),b=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],b.pageX-d>10?(c.off("touchmove"),C()):b.pageX-d<-10&&(c.off("touchmove"),B())}),!0}).on("touchend",function(){c.off("touchmove")}),l={init:y,next:B,prev:C,currentPos:z,length:A,appendItems:q,prependItems:r,close:x,clear:D,currentNode:function(){return j}}}});